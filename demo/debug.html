<!DOCTYPE html>
<html>
<head>
    <title>Pong engine debug</title>
    <script src="../build/build.js"></script>
</head>
<body>
<canvas id="demo" width="500" height="500"></canvas>
<div id="score">
  LEFT:<span id="left-player">0</span>
  RIGHT:<span id="right-player">0</span>
</div>
<script type="text/javascript">
    var PongBox2dDefinition = require("pong-box2d/src/box2dPongDefinition.js");
    var Box2D = require("pong-box2d/deps/box2dweb-commonjs").Box2D;
    var b2DebugDraw = Box2D.Dynamics.b2DebugDraw;
    var SCALE = 80;

    window.requestAnimFrame = (function(){
        return  window.requestAnimationFrame       ||
                window.webkitRequestAnimationFrame ||
                window.mozRequestAnimationFrame    ||
                window.oRequestAnimationFrame      ||
                window.msRequestAnimationFrame     ||
                function(/* function */ callback, /* DOMElement */ element){
                    window.setTimeout(callback, 1000 / 60);
                };
    })();


    var canvas = document.getElementById("demo");
    var ctx = canvas.getContext("2d");

    var pong = new PongBox2dDefinition(canvas.width / SCALE, canvas.height / SCALE, 0.15);

    var debugDraw = new b2DebugDraw();
    debugDraw.SetSprite(document.getElementById("demo").getContext("2d"));
    debugDraw.SetDrawScale(SCALE);
    debugDraw.SetFillAlpha(0.3);
    debugDraw.SetLineThickness(1.0);
    debugDraw.SetFlags(b2DebugDraw.e_shapeBit | b2DebugDraw.e_jointBit);

    // setup debug drawer
    pong._world.SetDebugDraw(debugDraw);
    pong.addPaddle(PongBox2dDefinition.playerType.LEFT, {width: 0.1, height: 1});
    pong.addPaddle(PongBox2dDefinition.playerType.RIGHT, {width: 0.1, height: 1});
    pong.onBallScored(function (player) {
      var score = +document.getElementById(player + '-player').innerText;
      document.getElementById(player + '-player').innerText = score + 1;
    });
    pong.positionBall({x: canvas.width / (2 * SCALE), y: canvas.height / (2 * SCALE)}, new Box2D.Common.Math.b2Vec2(5, 5));


    setInterval(function  () {
      var sign = Math.random() > 0.5 ? 1 : -1;
      pong.giveImpulseToPaddle(PongBox2dDefinition.playerType.RIGHT, new Box2D.Common.Math.b2Vec2(0, sign * 10));
    }, 800);

    setInterval(function  () {
      var sign = Math.random() > 0.5 ? 1 : -1;
      pong.giveImpulseToPaddle(PongBox2dDefinition.playerType.LEFT, new Box2D.Common.Math.b2Vec2(0, sign * 50));
    }, 700);


    // drawing loop
    function update() {
        pong._world.DrawDebugData();
        pong.tick(1/60, 10);
        requestAnimFrame(update);
    }
    requestAnimFrame(update);


</script>

</body>
</html>